
task copyGitPreCommitFile(type: Copy) {
    File preCommitFile = new File(rootProject.rootDir, '.git/hooks/pre-commit')
    if (preCommitFile == null || !preCommitFile.exists()) {
        from new File(rootProject.rootDir, 'hooks/pre-commit')
        into {
            new File(rootProject.rootDir, '.git/hooks')
        }
    }
    doLast {
        /**
         * 注意导入到 .git 目录后，需要对 ./git/hooks/pre-commit 执行 chmod u+x，否则会：
         * hint: The '.git/hooks/pre-commit' hook was ignored because it's not set as executable.
         */
        println 'execute chmod u+x pre-commit'
        exec {
            workingDir '.'
            commandLine 'sh', '-c', 'chmod u+x ' + rootProject.rootDir + '/.git/hooks/pre-commit'
        }
    }
}

allprojects {
    afterEvaluate {
        def preBuild = project.tasks.findByName('preBuild')
        if (preBuild != null)
            preBuild.dependsOn copyGitPreCommitFile
    }
}
